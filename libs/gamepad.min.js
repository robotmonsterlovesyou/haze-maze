/*!
 * gamepad.js v0.0.1-alpha
 * https://github.com/neogeek/gamepad.js
 *
 * Copyright (c) 2014 Scott Doxey
 * Dual-licensed under both MIT and BSD licenses.
 */

!function(){"use strict";function t(t){return t.match(/PLAYSTATION\(R\)3/i)||t.match(/Wireless 360 Controller/i)?"default":void 0}function o(){this.listeners=[],this.activeButtons=[],this.activeControllers=[],window.requestAnimationFrame(this._loop.bind(this))}var i={"default":{button_1:0,button_2:1,button_3:2,button_4:3,shoulder_top_left:4,shoulder_top_right:5,shoulder_bottom_left:6,shoulder_bottom_right:7,select:8,start:9,stick_button_left:10,stick_button_right:11,d_pad_up:12,d_pad_down:13,d_pad_left:14,d_pad_right:15,vendor:16}};o.prototype._handleController=function(o,n){var e=i[t(o.id)];this.listeners.forEach(function(t){if(o.buttons[e[t.button]]&&"function"===String(typeof t.callback)){if(this.activeButtons[n][t.button]||(this.activeButtons[n][t.button]={}),!this.activeButtons[n][t.button].delay&&t.options.delay)this.activeButtons[n][t.button].delay=t.options.delay;else if(this.activeButtons[n][t.button].delay)return this.activeButtons[n][t.button].delay=this.activeButtons[n][t.button].delay-1,!1;if(t.options.once&&this.activeButtons[n][t.button].triggered)return!1;this.activeButtons[n][t.button].triggered=!0,t.callback(t.button,n)}else this.activeButtons[n][t.button]&&(this.activeButtons[n][t.button]=null)}.bind(this))},o.prototype._loop=function(){var t,o=window.navigator.webkitGetGamepads();for(this.activeControllers=[],t=0;t<o.length;t+=1)o[t]&&o[t].id&&(this.activeButtons[t]||(this.activeButtons[t]={}),this.activeControllers.push(o[t]));this.activeControllers.forEach(this._handleController.bind(this)),window.requestAnimationFrame(this._loop.bind(this))},o.prototype.on=function(t,o,i){"function"===String(typeof o)&&"undefined"===String(typeof i)&&(i=o,o={}),this.listeners.push({button:t,options:o,callback:i})},o.prototype.off=function(t){this.listeners.forEach(function(o){o.button===t&&this.listeners.splice(this.listeners.indexOf(o),1)})},"function"===String(typeof window.define)&&window.define.hasOwnProperty("amd")?window.define([],function(){return o}):window.Gamepad=o}();
